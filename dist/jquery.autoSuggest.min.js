/*! jQuery AutoSuggest - v2.5.0 - 2013-08-20
 * URL: http://hlsolutions.github.com/jquery-autosuggest
 * Copyright (c) 2013 Jan Philipp
 * Licensed MIT, GPL */

(function(){var e,t,n,l,i,r,a,s=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},o=[].slice;e=jQuery,i=function(){function t(){}return t.prototype._=void 0,t.escapeQuotes=function(e){return e?e.replace(/"/g,'\\"'):void 0},t.escapeHtml=function(t){return e("<span/>").text(t).html()},t.setPlaceholderEnabled=function(e,t){var n,l,i;l=["placeholder","disabled-placeholder"],t?(n=l[1],i=l[0]):(n=l[0],i=l[1]),!e.attr(i)&&e.attr(n)&&(e.attr(i,function(){return e.attr(n)}),e.removeAttr(n))},t}(),t=function(){function t(){}return t.prototype._=void 0,t.getExtraParams=function(t){var n,l,i,r,a,s,o;if(r=t.extraParams,e.isFunction(r)&&(r=r(this)),"string"===e.type(r)){for(n={},o=r.split("&"),a=0,s=o.length;s>a;a++)l=o[a],""!==l&&(i=l.split("=",2),i.length&&(n[i[0]]=i[1]));r=n}return r},t}(),l=function(){function t(e,t){this.hiddenField=e,this.items=null!=t?t:[]}return t.prototype._=void 0,t.prototype.hiddenField=null,t.prototype.items=null,t.prototype.syncToHiddenField=function(){var e,t,n,l,i;if(this.hiddenField){for(t="",i=this.items,n=0,l=i.length;l>n;n++)e=i[n],t+=","+e;t&&(t+=","),this.hiddenField.val(t||",")}},t.prototype.add=function(e){this.exist(e)||this.items.push(e),this.syncToHiddenField()},t.prototype.remove=function(t){this.items=e.grep(this.items,function(e){return e!==t}),this.syncToHiddenField()},t.prototype.isEmpty=function(){return 0===this.items.length},t.prototype.exist=function(t){return-1!==e.inArray(t,this.items)},t.prototype.getAll=function(){return this.items.slice(0)},t.prototype.clear=function(){this.items=[],this.syncToHiddenField()},t}(),n=function(){function t(){}return t.onSelectionAdd=function(t,n,l,r,a,s){var o;o=r.onSelectionAdd.call(t,n,l,r),i.setPlaceholderEnabled(t,0===s.length),e.isFunction(r.afterSelectionAdd)&&r.afterSelectionAdd.call(t,o,a,s)},t.onSelectionRemove=function(t,n,l,r,a){e.isFunction(l.onSelectionRemove)&&l.onSelectionRemove.call(t,n,l),i.setPlaceholderEnabled(t,0===a.length),e.isFunction(l.afterSelectionRemove)&&l.afterSelectionRemove.call(t,n,r,a)},t.onSelectionClick=function(t,n,l,r,a){e.isFunction(l.afterSelectionClick)&&l.afterSelectionClick.call(t,n,r,a),i.setPlaceholderEnabled(t,0===a.length)},t.onAjaxRequestDone=function(t,n,l){e.isFunction(l.onAjaxRequestDone)&&n.done(l.onAjaxRequestDone)},t.onAjaxRequestFail=function(t,n,l){e.isFunction(l.onAjaxRequestFail)&&n.fail(l.onAjaxRequestFail)},t.onAjaxRequestAlways=function(t,n,l){e.isFunction(l.onAjaxRequestAlways)&&n.always(l.onAjaxRequestAlways)},t.onRenderErrorMessage=function(t,n,l,i){e.isFunction(i.onRenderErrorMessage)&&i.onRenderErrorMessage.call(t,n,l,i)},t.onRemoveErrorMessage=function(t,n,l,i){e.isFunction(i.onRenderErrorMessage)&&i.onRemoveErrorMessage.call(t,n,l,i)},t}(),r={prefix:"as",asHtmlID:!1,useOriginalInputName:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",emptyTextPlaceholder:/\{\d+\}/,limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchActive:!0,searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,maxChars:100,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,afterSelectionClick:null,afterSelectionAdd:null,afterSelectionRemove:null,onSelectionAdd:function(e,t){return e.before(t),e.prev()},onSelectionRemove:function(e,t){return t.fadeOut?e.fadeOut(t.fadeOut,function(){return e.remove()}):e.remove()},onRenderErrorMessage:function(t,n,l){var i;return i=e("#"+t.id),i.length||(n.closest("ul").after("<span id='"+t.id+"' class='"+l.prefix+"-error'></span>"),i=e("#"+t.id)),i.text(t.errorMessage),setTimeout(function(){return n.focus()},10)},onRemoveErrorMessage:function(t){return e("#"+t.id).remove()},formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,onResultItemClick:null,afterResultListShow:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"},fadeOut:!1,remoteFilter:!1},a={init:function(a,o){var c,u;return o=e.extend({},r,o),c=null,"auto"===o.remoteFilter&&(o.remoteFilter="string"===e.type(a)),(u=function(){switch(e.type(a)){case"function":return a;case"string":return function(l,i){var r,s,u,d;d={},d[""+o.queryParam]=encodeURIComponent(decodeURIComponent(l)),o.retrieveLimit&&(d[o.limitParam]=encodeURIComponent(o.retrieveLimit)),s=t.getExtraParams(o),"object"===e.type(s)&&e.extend(d,s),r=e.extend({},o.ajaxOptions,{url:a,data:d}),u=function(t){return e.isFunction(o.afterRequest)&&(t=o.afterRequest.apply(this,[t])),i(t,l)},c=e.ajax(r).done(u),n.onAjaxRequestDone(this,c,o),n.onAjaxRequestFail(this,c,o),n.onAjaxRequestAlways(this,c,o)};case"array":case"object":return function(e,t){return t(a,e)}}}())?this.each(function(){var t,r,a,d,p,f,m,h,v,g,x,y,C,R,P,A,b,w,F,S,k,E,I,q,j,T,M,L,D,H,O,V,N,_,W,G,Q,U;switch(o.inputAttrs=e.extend(o.inputAttrs,{}),C=!1,x=e(this),p=null,f=null,m=null,h=null,v=null,H=null,o.asHtmlID?(p=o.asHtmlID,f=p,h=""+o.prefix+"-values-"+p,H=""+o.prefix+"-validation-error-"+p,o.useOriginalInputName?(v=x.attr("name"),x.attr({name:"old_"+x.attr("name")})):v=""+o.prefix+"_values_"+p):(p=""+(p||"")+Math.floor(100*Math.random()),f=""+o.prefix+"-input-"+p,h=""+o.prefix+"-values-"+p,H=""+o.prefix+"-validation-error-"+p,o.useOriginalInputName?(v=x.attr("name"),x.attr({name:"old_"+x.attr("name")})):v=""+o.prefix+"_values_"+p),o.inputAttrs.id=f,o.usePlaceholder||(o.inputAttrs.placeholder=o.startText),x.attr(o.inputAttrs),x.addClass(""+o.prefix+"-input"),o.usePlaceholder||x.val(o.startText),x.wrap('<ul class="'+o.prefix+'-selections" id="'+o.prefix+"-selections-"+p+'"></ul>').wrap('<li class="'+o.prefix+'-original" id="'+o.prefix+"-original-"+p+'"></li>'),L=e("#"+o.prefix+"-selections-"+p),y=e("#"+o.prefix+"-original-"+p),T=e('<div class="'+o.prefix+'-results" id="'+o.prefix+"-results-"+p+'"></div>'),M=e('<ul class="'+o.prefix+'-list"></ul>'),m=e('<input type="hidden" class="'+o.prefix+'-values" name="'+v+'" id="'+h+'" />'),d=new l(m),R=null,D=null,E="",w=!1,b=null,k=0,j={add:function(t){var n,l;n=e(L).find("li").length,l=r(t,"u"+n),null!=l&&l.addClass("blur")},remove:function(e){d.remove(e),L.find('li[data-value="'+i.escapeHtml(e)+'"]').remove()}},a=function(){return{add:j.add,remove:j.remove}},x.bind("addSelection",function(e,t){return j.add(t)}),x.bind("removeSelection",function(e,t){return j.remove(t)}),r=function(t,l){var r,a;return d.add(t[o.selectedValuesProp]),a=e('<li class="'+o.prefix+'-selection-item" id="'+o.prefix+"-selection-"+l+'" data-value="'+i.escapeQuotes(i.escapeHtml(t[o.selectedValuesProp]))+'"></li>'),a.on({click:function(){p=e(this),n.onSelectionClick(x,p,o,t[o.selectedValuesProp],d.getAll()),L.children().removeClass("selected"),p.addClass("selected")},mousedown:function(){C=!1}}),r=e('<a class="'+o.prefix+'-close">&times;</a>'),r.click(function(){return d.remove(t[o.selectedValuesProp]),n.onSelectionRemove(x,a,o,null,d.getAll()),C=!0,x.focus(),!1}),"string"!=typeof t[o.selectedItemProp]?n.onSelectionAdd(x,y,a.append(t[o.selectedItemProp]).prepend(r),o,t,d.getAll()):n.onSelectionAdd(x,y,a.text(t[o.selectedItemProp]).prepend(r),o,t,d.getAll()),y.prev()},e.isFunction(o.start)&&o.start.call(this,a()),e.type(o.preFill)){case"string":for(Q=o.preFill.split(","),N=0,W=Q.length;W>N;N++)V=Q[N],P={},P[""+o.selectedValuesProp]=V,""!==V&&r(P,"000"+g);break;case"array":if(o.preFill.length)for(e.isFunction(o.afterRequest)&&(o.preFill=o.afterRequest.call(this,o.preFill)),U=o.preFill,g=_=0,G=U.length;G>_;g=++_)P=U[g],S=P[o.selectedValuesProp],S===void 0&&(S=""),""!==S&&r(P,"000"+g)}return d.isEmpty()||(x.val(""),L.find("li."+o.prefix+"-selection-item").addClass("blur").removeClass("selected"),i.setPlaceholderEnabled(x,!1)),x.after(m),L.on({click:function(){C=!0,x.focus()},mousedown:function(){L.children().removeClass("selected"),C=!1}}),L.after(T),A=function(){var e,t,n;return 46===b||s.call(function(){for(n=[],t=9;31>t;t++)n.push(t);return n}.apply(this),b)>=0?(T.hide(),void 0):(e=x.val().replace(/[\\]+|[\/]+/g,""),""===e||e!==E?(E=e,O.allValid(e.length)||0===o.minChars&&0===e.length?(L.addClass("loading"),q(e)):(L.removeClass("loading"),T.hide())):void 0)},q=function(n){return e.isFunction(o.beforeRequest)&&(n=o.beforeRequest.apply(this,[n,o])),t(),u(n,I)},I=function(t,n){var l,a,s,c,u,f,m,h,v,g,y,R,A,b,F,S,I;for(l=!1,m=n,o.matchCase||(n=n.toLowerCase()),n=n.replace("(","(","g").replace(")",")","g"),c=0,T.hide().html(M.html("")),f=0,o.canGenerateNewSelections&&o.creationText&&0===e.grep(t,function(e){return e[o.selectedItemProp].toLowerCase()===n}).length&&!d.exist(n)&&(a=e('<li class="'+o.prefix+'-result-item" id="'+o.prefix+"-result-item-"+f+'"></li>'),a.on({click:function(){var e;e={},e[""+o.selectedItemProp]=m,e[""+o.selectedValuesProp]=m,x.val("").focus(),E="",r(e,"00"+(L.find("li").length+1)),T.hide()},mousedown:function(){C=!1},mouseover:function(){p=e(this),M.find("li").removeClass("active"),p.addClass("active")}}),a.data("data",{attributes:t[f],num:k}),a=a.html("<em>"+m+"</em>"+o.creationText),M.append(a),l=!0),A=0,F=t.length;F>A;A++){if(P=t[A],k++,s=!1,"value"===o.searchObjProps)g=P.value;else for(g="",I=o.searchObjProps.split(","),b=0,S=I.length;S>b;b++)u=I[b],g+=""+P[e.trim(u)]+" ";if(g&&(o.matchCase||(g=g.toLowerCase()),o.searchActive&&(-1===g.indexOf(n)&&!o.remoteFilter||d.exist(P[o.selectedValuesProp]))||(s=!0)),s&&(a=e('<li class="'+o.prefix+'-result-item" id="a'+o.prefix+"-result-item-"+f+'"></li>'),a.on({click:function(){var n,l;p=e(this),l=p.data("data"),n=l.num,0>=L.find("#"+o.prefix+"-selection-"+n).length&&!w&&(t=l.attributes,x.val("").focus(),E="",r(t,n),e.isFunction(o.onResultItemClick)&&o.onResultItemClick.call(this,l),T.hide()),w=!1},mousedown:function(){C=!1},mouseover:function(){p=e(this),M.find("li").removeClass("active"),p.addClass("active")}}),a.data("data",{attributes:t[f],num:k}),R=e.extend({},t[f]),n=n.replace(/"/g,'\\"'),h=o.matchCase?RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(n)+")(?![^<>]*>)(?![^&;]+;)","g"):RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(n)+")(?![^<>]*>)(?![^&;]+;)","gi"),"string"==typeof R[o.selectedItemProp]?(R[o.selectedItemProp]=i.escapeHtml(R[o.selectedItemProp]),o.resultsHighlight&&n.length>0&&(R[o.selectedItemProp]=R[o.selectedItemProp].replace(h,"<em>$1</em>"))):o.resultsHighlight&&n.length>0&&R[o.selectedItemProp].html(R[o.selectedItemProp].html().replace(h,"<em>$1</em>")),a=o.formatList?o.formatList.call(this,R,a):a.html(R[o.selectedItemProp]),M.append(a),c++,o.retrieveLimit&&o.retrieveLimit===c))break;f+=1}L.removeClass("loading"),0>=c&&!l&&(y=o.emptyText,"regexp"===e.type(o.emptyTextPlaceholder)&&(y=y.replace(o.emptyTextPlaceholder,n)),M.html('<li class="'+o.prefix+'-message">'+y+"</li>")),M.css({width:L.outerWidth()}),v=c>0||o.showResultListWhenNoMatch||o.creationText,v&&T.show(),e.isFunction(o.afterResultListShow)&&o.afterResultListShow.call(this,v)},F=function(e){var t,n,l;if(T.find(":visible").length){switch(n=T.find("li"),e){case"down":l=n.eq(0);break;default:l=n.filter(":last")}if(t=T.find("li.active:first"),t.length)switch(e){case"down":l=t.next();break;default:l=t.prev()}n.removeClass("active"),l.addClass("active")}},t=function(){c&&(c.abort(),c=null)},O={clear:function(){var e;return e={id:H},n.onRemoveErrorMessage(x,e,x,o)},allValid:function(e){return e>=o.minChars&&o.maxChars>=e},renderMinChars:function(){var e;return e={id:H,errorMessage:"must be at least "+o.minChars+" characters",type:"minChars",limit:o.minChars},n.onRenderErrorMessage(x,e,x,o)},renderMaxChars:function(){var e;return e={id:H,errorMessage:"must be "+o.maxChars+" characters or fewer",type:"maxChars",limit:o.maxChars},n.onRenderErrorMessage(x,e,x,o)}},x.on({focus:function(){return p=e(this),!o.usePlaceholder&&p.val()===o.startText&&d.isEmpty()?p.val(""):C&&(L.find("li."+o.prefix+"-selections-item").removeClass("blur"),""!==p.val()&&(M.css({width:L.outerWidth()}),O.allValid()&&T.show())),R&&clearInterval(R),R=setInterval(function(){o.showResultList&&(o.selectionLimit&&L.find("li."+o.prefix+"-selection-item").length>=o.selectionLimit?(M.html('<li class="'+o.prefix+'-message">'+o.limitText+"</li>"),O.allValid()&&T.show()):A())},o.keyDelay),C=!0,0===o.minChars&&q(p.val()),!0},blur:function(){p=e(this),!o.usePlaceholder&&""===p.val()&&d.isEmpty()&&o.minChars>0?p.val(o.startText):C&&(L.find("li."+o.prefix+"-selection-item").addClass("blur").removeClass("selected"),T.hide()),R&&clearInterval(R),i.setPlaceholderEnabled(p,d.isEmpty())},keyup:function(){var e;return e=x.val().replace(/(,)/g,"").length,e>o.maxChars&&O.renderMaxChars(),O.allValid(e)||0===e?O.clear():void 0},keydown:function(l){var a,s,c,u,p,f;switch(b=l.keyCode,s=!1,c=x.val().replace(/(,)/g,""),l.keyCode){case 38:l.preventDefault(),F("up");break;case 40:l.preventDefault(),e(":visible",T).length>0?F("down"):(D&&clearTimeout(D),D=setTimeout(function(){A()},o.keyDelay));break;case 8:""===x.val()&&(f=d.getAll(),p=null,p=f.length?f[f.length-1]:null,L.children().not(y.prev()).removeClass("selected"),y.prev().hasClass("selected")?(d.remove(p),n.onSelectionRemove(x,y.prev(),o,null,d.getAll())):(n.onSelectionClick(x,y.prev(),o,null,d.getAll()),y.prev().addClass("selected"))),1===x.val().length&&(T.hide(),E="",t(),O.clear()),T.find(":visible").length&&(D&&clearTimeout(D),D=setTimeout(function(){A()},o.keyDelay));break;case 9:case 13:case 188:w=9===l.keyCode,a=T.find("li.active:visible:first"),13===l.keyCode&&T.find("li.active:first").length?(a.click(),T.hide(),o.neverSubmit&&l.preventDefault(),a=T.find("li.active:first")):o.canGenerateNewSelections?c.length>o.maxChars?O.renderMaxChars():0!==c.length&&c.length<o.minChars?O.renderMinChars():""===c||d.exist(c)||0!==a.length||(l.preventDefault(),u={},u[""+o.selectedItemProp]=c,u[""+o.selectedValuesProp]=c,r(u,"00"+(L.find("li").length+1)),x.val(""),O.clear(),t()):x.val(""),a.length&&(w=!1,a.click(),T.hide(),o.neverSubmit&&l.preventDefault());break;case 27:o.preventPropagationOnEscape&&T.find(":visible").length&&l.stopPropagation();break;case 16:case 20:t(),T.hide()}i.setPlaceholderEnabled(x,d.isEmpty())}})}):void 0},add:function(){var t,n,l,i,r;for(l=arguments.length>=1?o.call(arguments,0):[],t=e(this),i=0,r=l.length;r>i;i++)n=l[i],t.trigger("addSelection",n)},remove:function(){var t,n,l,i,r;for(l=arguments.length>=1?o.call(arguments,0):[],t=e(this),i=0,r=l.length;r>i;i++)n=l[i],t.trigger("removeSelection",n)},defaults:function(t,n){null==n&&(n=!1),n&&(r={}),e.extend(r,t)}},e.fn.autoSuggest=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):a.init.apply(this,arguments)}}).call(this);