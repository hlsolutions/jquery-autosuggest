/*! jQuery AutoSuggest - v2.4.1 - 2013-08-20
 * URL: http://hlsolutions.github.com/jquery-autosuggest
 * Copyright (c) 2013 Jan Philipp
 * Licensed MIT, GPL */

(function(){var e,t,n,l,i,a,s,r=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},o=[].slice;e=jQuery,i=function(){function t(){}return t.prototype._=void 0,t.escapeQuotes=function(e){return e?e.replace(/"/g,'\\"'):void 0},t.escapeHtml=function(t){return e("<span/>").text(t).html()},t.setPlaceholderEnabled=function(e,t){var n,l,i;l=["placeholder","disabled-placeholder"],t?(n=l[1],i=l[0]):(n=l[0],i=l[1]),!e.attr(i)&&e.attr(n)&&(e.attr(i,function(){return e.attr(n)}),e.removeAttr(n))},t}(),t=function(){function t(){}return t.prototype._=void 0,t.getExtraParams=function(t){var n,l,i,a,s,r,o;if(a=t.extraParams,e.isFunction(a)&&(a=a(this)),"string"===e.type(a)){for(n={},o=a.split("&"),s=0,r=o.length;r>s;s++)l=o[s],""!==l&&(i=l.split("=",2),i.length&&(n[i[0]]=i[1]));a=n}return a},t}(),l=function(){function t(e,t){this.hiddenField=e,this.items=null!=t?t:[]}return t.prototype._=void 0,t.prototype.hiddenField=null,t.prototype.items=null,t.prototype.syncToHiddenField=function(){var e,t,n,l,i;if(this.hiddenField){for(t="",i=this.items,n=0,l=i.length;l>n;n++)e=i[n],t+=","+e;t&&(t+=","),this.hiddenField.val(t||",")}},t.prototype.add=function(e){this.exist(e)||this.items.push(e),this.syncToHiddenField()},t.prototype.remove=function(t){this.items=e.grep(this.items,function(e){return e!==t}),this.syncToHiddenField()},t.prototype.isEmpty=function(){return 0===this.items.length},t.prototype.exist=function(t){return-1!==e.inArray(t,this.items)},t.prototype.getAll=function(){return this.items.slice(0)},t.prototype.clear=function(){this.items=[],this.syncToHiddenField()},t}(),n=function(){function t(){}return t.onSelectionAdd=function(t,n,l,a,s,r){var o;o=a.onSelectionAdd.call(t,n,l,a),i.setPlaceholderEnabled(t,0===r.length),e.isFunction(a.afterSelectionAdd)&&a.afterSelectionAdd.call(t,o,s,r)},t.onSelectionRemove=function(t,n,l,a,s){e.isFunction(l.onSelectionRemove)&&l.onSelectionRemove.call(t,n,l),i.setPlaceholderEnabled(t,0===s.length),e.isFunction(l.afterSelectionRemove)&&l.afterSelectionRemove.call(t,n,a,s)},t.onSelectionClick=function(t,n,l,a,s){e.isFunction(l.afterSelectionClick)&&l.afterSelectionClick.call(t,n,a,s),i.setPlaceholderEnabled(t,0===s.length)},t.onAjaxRequestDone=function(t,n,l){e.isFunction(l.onAjaxRequestDone)&&n.done(l.onAjaxRequestDone)},t.onAjaxRequestFail=function(t,n,l){e.isFunction(l.onAjaxRequestFail)&&n.fail(l.onAjaxRequestFail)},t.onAjaxRequestAlways=function(t,n,l){e.isFunction(l.onAjaxRequestAlways)&&n.always(l.onAjaxRequestAlways)},t.onRenderErrorMessage=function(t,n,l,i){e.isFunction(i.onRenderErrorMessage)&&i.onRenderErrorMessage.call(t,n,l,i)},t.onRemoveErrorMessage=function(t,n,l,i){e.isFunction(i.onRenderErrorMessage)&&i.onRemoveErrorMessage.call(t,n,l,i)},t}(),a={asHtmlID:!1,useOriginalInputName:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",emptyTextPlaceholder:/\{\d+\}/,limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchActive:!0,searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,maxChars:100,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,afterSelectionClick:null,afterSelectionAdd:null,afterSelectionRemove:null,onSelectionAdd:function(e,t){return e.before(t),e.prev()},onSelectionRemove:function(e,t){return t.fadeOut?e.fadeOut(t.fadeOut,function(){return e.remove()}):e.remove()},onRenderErrorMessage:function(t,n){var l;return l=e("#"+t.id),l.length||(n.closest("ul").after("<span id='"+t.id+"' class='as-error'></span>"),l=e("#"+t.id)),l.text(t.errorMessage),setTimeout(function(){return n.focus()},10)},onRemoveErrorMessage:function(t){return e("#"+t.id).remove()},formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,onResultItemClick:null,afterResultListShow:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"},fadeOut:!1,remoteFilter:!1},s={init:function(s,o){var c,u;return o=e.extend({},a,o),c=null,"auto"===o.remoteFilter&&(o.remoteFilter="string"===e.type(s)),(u=function(){switch(e.type(s)){case"function":return s;case"string":return function(l,i){var a,r,u,d;d={},d[""+o.queryParam]=encodeURIComponent(decodeURIComponent(l)),o.retrieveLimit&&(d[o.limitParam]=encodeURIComponent(o.retrieveLimit)),r=t.getExtraParams(o),"object"===e.type(r)&&e.extend(d,r),a=e.extend({},o.ajaxOptions,{url:s,data:d}),u=function(t){return e.isFunction(o.afterRequest)&&(t=o.afterRequest.apply(this,[t])),i(t,l)},c=e.ajax(a).done(u),n.onAjaxRequestDone(this,c,o),n.onAjaxRequestFail(this,c,o),n.onAjaxRequestAlways(this,c,o)};case"array":case"object":return function(e,t){return t(s,e)}}}())?this.each(function(){var t,a,s,d,m,h,p,f,v,g,y,x,C,R,P,A,b,w,F,S,k,E,I,q,j,T,M,L,D,H,O,V,N,_,W,G,Q,U;switch(o.inputAttrs=e.extend(o.inputAttrs,{}),C=!1,y=e(this),m=null,h=null,p=null,f=null,v=null,H=null,o.asHtmlID?(m=o.asHtmlID,h=m,f="as-values-"+m,H="as-validation-error-"+m,o.useOriginalInputName?(v=y.attr("name"),y.attr({name:"old_"+y.attr("name")})):v="as_values_"+m):(m=""+(m||"")+Math.floor(100*Math.random()),h="as-input-"+m,f="as-values-"+m,H="as-validation-error-"+m,o.useOriginalInputName?(v=y.attr("name"),y.attr({name:"old_"+y.attr("name")})):v="as_values_"+m),o.inputAttrs.id=h,o.usePlaceholder||(o.inputAttrs.placeholder=o.startText),y.attr(o.inputAttrs),y.addClass("as-input"),o.usePlaceholder||y.val(o.startText),y.wrap('<ul class="as-selections" id="as-selections-'+m+'"></ul>').wrap('<li class="as-original" id="as-original-'+m+'"></li>'),L=e("#as-selections-"+m),x=e("#as-original-"+m),T=e('<div class="as-results" id="as-results-'+m+'"></div>'),M=e('<ul class="as-list"></ul>'),p=e('<input type="hidden" class="as-values" name="'+v+'" id="'+f+'" />'),d=new l(p),R=null,D=null,E="",w=!1,b=null,k=0,j={add:function(t){var n,l;n=e(L).find("li").length,l=a(t,"u"+n),null!=l&&l.addClass("blur")},remove:function(e){d.remove(e),L.find('li[data-value="'+i.escapeHtml(e)+'"]').remove()}},s=function(){return{add:j.add,remove:j.remove}},y.bind("addSelection",function(e,t){return j.add(t)}),y.bind("removeSelection",function(e,t){return j.remove(t)}),a=function(t,l){var a,s;return d.add(t[o.selectedValuesProp]),s=e('<li class="as-selection-item" id="as-selection-'+l+'" data-value="'+i.escapeQuotes(i.escapeHtml(t[o.selectedValuesProp]))+'"></li>'),s.on({click:function(){m=e(this),n.onSelectionClick(y,m,o,t[o.selectedValuesProp],d.getAll()),L.children().removeClass("selected"),m.addClass("selected")},mousedown:function(){C=!1}}),a=e('<a class="as-close">&times;</a>'),a.click(function(){return d.remove(t[o.selectedValuesProp]),n.onSelectionRemove(y,s,o,null,d.getAll()),C=!0,y.focus(),!1}),"string"!=typeof t[o.selectedItemProp]?n.onSelectionAdd(y,x,s.append(t[o.selectedItemProp]).prepend(a),o,t,d.getAll()):n.onSelectionAdd(y,x,s.text(t[o.selectedItemProp]).prepend(a),o,t,d.getAll()),x.prev()},e.isFunction(o.start)&&o.start.call(this,s()),e.type(o.preFill)){case"string":for(Q=o.preFill.split(","),N=0,W=Q.length;W>N;N++)V=Q[N],P={},P[""+o.selectedValuesProp]=V,""!==V&&a(P,"000"+g);break;case"array":if(o.preFill.length)for(e.isFunction(o.afterRequest)&&(o.preFill=o.afterRequest.call(this,o.preFill)),U=o.preFill,g=_=0,G=U.length;G>_;g=++_)P=U[g],S=P[o.selectedValuesProp],S===void 0&&(S=""),""!==S&&a(P,"000"+g)}return d.isEmpty()||(y.val(""),L.find("li.as-selection-item").addClass("blur").removeClass("selected"),i.setPlaceholderEnabled(y,!1)),y.after(p),L.on({click:function(){C=!0,y.focus()},mousedown:function(){L.children().removeClass("selected"),C=!1}}),L.after(T),A=function(){var e,t,n;return 46===b||r.call(function(){for(n=[],t=9;31>t;t++)n.push(t);return n}.apply(this),b)>=0?(T.hide(),void 0):(e=y.val().replace(/[\\]+|[\/]+/g,""),""===e||e!==E?(E=e,O.allValid(e.length)||0===o.minChars&&0===e.length?(L.addClass("loading"),q(e)):(L.removeClass("loading"),T.hide())):void 0)},q=function(n){return e.isFunction(o.beforeRequest)&&(n=o.beforeRequest.apply(this,[n,o])),t(),u(n,I)},I=function(t,n){var l,s,r,c,u,h,p,f,v,g,x,R,A,b,F,S,I;for(l=!1,p=n,o.matchCase||(n=n.toLowerCase()),n=n.replace("(","(","g").replace(")",")","g"),c=0,T.hide().html(M.html("")),h=0,o.canGenerateNewSelections&&o.creationText&&0===e.grep(t,function(e){return e[o.selectedItemProp].toLowerCase()===n}).length&&!d.exist(n)&&(s=e('<li class="as-result-item" id="as-result-item-'+h+'"></li>'),s.on({click:function(){var e;e={},e[""+o.selectedItemProp]=p,e[""+o.selectedValuesProp]=p,y.val("").focus(),E="",a(e,"00"+(L.find("li").length+1)),T.hide()},mousedown:function(){C=!1},mouseover:function(){m=e(this),M.find("li").removeClass("active"),m.addClass("active")}}),s.data("data",{attributes:t[h],num:k}),s=s.html("<em>"+p+"</em>"+o.creationText),M.append(s),l=!0),A=0,F=t.length;F>A;A++){if(P=t[A],k++,r=!1,"value"===o.searchObjProps)g=P.value;else for(g="",I=o.searchObjProps.split(","),b=0,S=I.length;S>b;b++)u=I[b],g+=""+P[e.trim(u)]+" ";if(g&&(o.matchCase||(g=g.toLowerCase()),o.searchActive&&(-1===g.indexOf(n)&&!o.remoteFilter||d.exist(P[o.selectedValuesProp]))||(r=!0)),r&&(s=e('<li class="as-result-item" id="as-result-item-'+h+'"></li>'),s.on({click:function(){var n,l;m=e(this),l=m.data("data"),n=l.num,0>=L.find("#as-selection-"+n).length&&!w&&(t=l.attributes,y.val("").focus(),E="",a(t,n),e.isFunction(o.onResultItemClick)&&o.onResultItemClick.call(this,l),T.hide()),w=!1},mousedown:function(){C=!1},mouseover:function(){m=e(this),M.find("li").removeClass("active"),m.addClass("active")}}),s.data("data",{attributes:t[h],num:k}),R=e.extend({},t[h]),n=n.replace(/"/g,'\\"'),f=o.matchCase?RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(n)+")(?![^<>]*>)(?![^&;]+;)","g"):RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.escapeHtml(n)+")(?![^<>]*>)(?![^&;]+;)","gi"),"string"==typeof R[o.selectedItemProp]?(R[o.selectedItemProp]=i.escapeHtml(R[o.selectedItemProp]),o.resultsHighlight&&n.length>0&&(R[o.selectedItemProp]=R[o.selectedItemProp].replace(f,"<em>$1</em>"))):o.resultsHighlight&&n.length>0&&R[o.selectedItemProp].html(R[o.selectedItemProp].html().replace(f,"<em>$1</em>")),s=o.formatList?o.formatList.call(this,R,s):s.html(R[o.selectedItemProp]),M.append(s),c++,o.retrieveLimit&&o.retrieveLimit===c))break;h+=1}L.removeClass("loading"),0>=c&&!l&&(x=o.emptyText,"regexp"===e.type(o.emptyTextPlaceholder)&&(x=x.replace(o.emptyTextPlaceholder,n)),M.html('<li class="as-message">'+x+"</li>")),M.css({width:L.outerWidth()}),v=c>0||o.showResultListWhenNoMatch||o.creationText,v&&T.show(),e.isFunction(o.afterResultListShow)&&o.afterResultListShow.call(this,v)},F=function(e){var t,n,l;if(T.find(":visible").length){switch(n=T.find("li"),e){case"down":l=n.eq(0);break;default:l=n.filter(":last")}if(t=T.find("li.active:first"),t.length)switch(e){case"down":l=t.next();break;default:l=t.prev()}n.removeClass("active"),l.addClass("active")}},t=function(){c&&(c.abort(),c=null)},O={clear:function(){var e;return e={id:H},n.onRemoveErrorMessage(y,e,y,o)},allValid:function(e){return e>=o.minChars&&o.maxChars>=e},renderMinChars:function(){var e;return e={id:H,errorMessage:"must be at least "+o.minChars+" characters",type:"minChars",limit:o.minChars},n.onRenderErrorMessage(y,e,y,o)},renderMaxChars:function(){var e;return e={id:H,errorMessage:"must be "+o.maxChars+" characters or fewer",type:"maxChars",limit:o.maxChars},n.onRenderErrorMessage(y,e,y,o)}},y.on({focus:function(){return m=e(this),!o.usePlaceholder&&m.val()===o.startText&&d.isEmpty()?m.val(""):C&&(L.find("li.as-selections-item").removeClass("blur"),""!==m.val()&&(M.css({width:L.outerWidth()}),O.allValid()&&T.show())),R&&clearInterval(R),R=setInterval(function(){o.showResultList&&(o.selectionLimit&&L.find("li.as-selection-item").length>=o.selectionLimit?(M.html('<li class="as-message">'+o.limitText+"</li>"),O.allValid()&&T.show()):A())},o.keyDelay),C=!0,0===o.minChars&&q(m.val()),!0},blur:function(){m=e(this),!o.usePlaceholder&&""===m.val()&&d.isEmpty()&&o.minChars>0?m.val(o.startText):C&&(L.find("li.as-selection-item").addClass("blur").removeClass("selected"),T.hide()),R&&clearInterval(R),i.setPlaceholderEnabled(m,d.isEmpty())},keyup:function(){var e;return e=y.val().replace(/(,)/g,"").length,e>o.maxChars&&O.renderMaxChars(),O.allValid(e)||0===e?O.clear():void 0},keydown:function(l){var s,r,c,u,m,h;switch(b=l.keyCode,r=!1,c=y.val().replace(/(,)/g,""),l.keyCode){case 38:l.preventDefault(),F("up");break;case 40:l.preventDefault(),e(":visible",T).length>0?F("down"):(D&&clearTimeout(D),D=setTimeout(function(){A()},o.keyDelay));break;case 8:""===y.val()&&(h=d.getAll(),m=null,m=h.length?h[h.length-1]:null,L.children().not(x.prev()).removeClass("selected"),x.prev().hasClass("selected")?(d.remove(m),n.onSelectionRemove(y,x.prev(),o,null,d.getAll())):(n.onSelectionClick(y,x.prev(),o,null,d.getAll()),x.prev().addClass("selected"))),1===y.val().length&&(T.hide(),E="",t(),O.clear()),T.find(":visible").length&&(D&&clearTimeout(D),D=setTimeout(function(){A()},o.keyDelay));break;case 9:case 13:case 188:w=9===l.keyCode,s=T.find("li.active:visible:first"),13===l.keyCode&&T.find("li.active:first").length?(s.click(),T.hide(),o.neverSubmit&&l.preventDefault(),s=T.find("li.active:first")):o.canGenerateNewSelections?c.length>o.maxChars?O.renderMaxChars():0!==c.length&&c.length<o.minChars?O.renderMinChars():""===c||d.exist(c)||0!==s.length||(l.preventDefault(),u={},u[""+o.selectedItemProp]=c,u[""+o.selectedValuesProp]=c,a(u,"00"+(L.find("li").length+1)),y.val(""),O.clear(),t()):y.val(""),s.length&&(w=!1,s.click(),T.hide(),o.neverSubmit&&l.preventDefault());break;case 27:o.preventPropagationOnEscape&&T.find(":visible").length&&l.stopPropagation();break;case 16:case 20:t(),T.hide()}i.setPlaceholderEnabled(y,d.isEmpty())}})}):void 0},add:function(){var t,n,l,i,a;for(l=arguments.length>=1?o.call(arguments,0):[],t=e(this),i=0,a=l.length;a>i;i++)n=l[i],t.trigger("addSelection",n)},remove:function(){var t,n,l,i,a;for(l=arguments.length>=1?o.call(arguments,0):[],t=e(this),i=0,a=l.length;a>i;i++)n=l[i],t.trigger("removeSelection",n)},defaults:function(t,n){null==n&&(n=!1),n&&(a={}),e.extend(a,t)}},e.fn.autoSuggest=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):s.init.apply(this,arguments)}}).call(this);