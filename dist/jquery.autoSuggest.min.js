/*! jQuery AutoSuggest - v2.3.0 - 2013-08-06
 * URL: http://hlsolutions.github.com/jquery-autosuggest
 * Copyright (c) 2013 Jan Philipp
 * Licensed MIT, GPL */

!function(){var a,b,c,d,e,f,g,h=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},i=[].slice;a=jQuery,e=function(){function b(){}return b.prototype._=void 0,b.escapeQuotes=function(a){return a?a.replace(/"/g,'\\"'):void 0},b.escapeHtml=function(b){return a("<span/>").text(b).html()},b.setPlaceholderEnabled=function(a,b){var c,d,e;d=["placeholder","disabled-placeholder"],b?(c=d[1],e=d[0]):(c=d[0],e=d[1]),!a.attr(e)&&a.attr(c)&&(a.attr(e,function(){return a.attr(c)}),a.removeAttr(c))},b}(),b=function(){function b(){}return b.prototype._=void 0,b.getExtraParams=function(b){var c,d,e,f,g,h,i;if(f=b.extraParams,a.isFunction(f)&&(f=f(this)),"string"===a.type(f)){for(c={},i=f.split("&"),g=0,h=i.length;h>g;g++)d=i[g],""!==d&&(e=d.split("=",2),e.length&&(c[e[0]]=e[1]));f=c}return f},b}(),d=function(){function b(a,b){this.hiddenField=a,this.items=null!=b?b:[]}return b.prototype._=void 0,b.prototype.hiddenField=null,b.prototype.items=null,b.prototype.syncToHiddenField=function(){var a,b,c,d,e;if(this.hiddenField){for(b="",e=this.items,c=0,d=e.length;d>c;c++)a=e[c],b+=","+a;b&&(b+=","),this.hiddenField.val(b||",")}},b.prototype.add=function(a){this.exist(a)||this.items.push(a),this.syncToHiddenField()},b.prototype.remove=function(b){this.items=a.grep(this.items,function(a){return a!==b}),this.syncToHiddenField()},b.prototype.isEmpty=function(){return 0===this.items.length},b.prototype.exist=function(b){return-1!==a.inArray(b,this.items)},b.prototype.getAll=function(){return this.items.slice(0)},b.prototype.clear=function(){this.items=[],this.syncToHiddenField()},b}(),c=function(){function b(){}return b.onSelectionAdd=function(b,c,d,f,g,h){var i;i=f.onSelectionAdd.call(b,c,d,f),e.setPlaceholderEnabled(b,0===h.length),a.isFunction(f.afterSelectionAdd)&&f.afterSelectionAdd.call(b,i,g,h)},b.onSelectionRemove=function(b,c,d,f,g){a.isFunction(d.onSelectionRemove)&&d.onSelectionRemove.call(b,c,d),e.setPlaceholderEnabled(b,0===g.length),a.isFunction(d.afterSelectionRemove)&&d.afterSelectionRemove.call(b,c,f,g)},b.onSelectionClick=function(b,c,d,f,g){a.isFunction(d.afterSelectionClick)&&d.afterSelectionClick.call(b,c,f,g),e.setPlaceholderEnabled(b,0===g.length)},b.onAjaxRequestDone=function(b,c,d){a.isFunction(d.onAjaxRequestDone)&&c.done(d.onAjaxRequestDone)},b.onAjaxRequestFail=function(b,c,d){a.isFunction(d.onAjaxRequestFail)&&c.fail(d.onAjaxRequestFail)},b.onAjaxRequestAlways=function(b,c,d){a.isFunction(d.onAjaxRequestAlways)&&c.always(d.onAjaxRequestAlways)},b}(),f={asHtmlID:!1,useOriginalInputName:!1,usePlaceholder:!1,preFill:null,startText:"Enter Name Here",emptyText:"No Results Found",emptyTextPlaceholder:/\{\d+\}/,limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchActive:!0,searchObjProps:"value",queryParam:"q",limitParam:"limit",retrieveLimit:null,extraParams:null,matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:null,afterSelectionClick:null,afterSelectionAdd:null,afterSelectionRemove:null,onSelectionAdd:function(a,b){return a.before(b),a.prev()},onSelectionRemove:function(a,b){return b.fadeOut?a.fadeOut(b.fadeOut,function(){return a.remove()}):a.remove()},formatList:null,beforeRequest:null,afterRequest:null,onAjaxRequestDone:null,onAjaxRequestFail:null,onAjaxRequestAlways:null,onResultItemClick:null,afterResultListShow:null,neverSubmit:!1,preventPropagationOnEscape:!1,ajaxOptions:{type:"get",dataType:"json"},inputAttrs:{autocomplete:"off"},fadeOut:!1,remoteFilter:!1},g={init:function(g,i){var j,k;return i=a.extend({},f,i),j=null,"auto"===i.remoteFilter&&(i.remoteFilter="string"===a.type(g)),(k=function(){switch(a.type(g)){case"function":return g;case"string":return function(d,e){var f,h,k,l;l={},l[""+i.queryParam]=encodeURIComponent(decodeURIComponent(d)),i.retrieveLimit&&(l[i.limitParam]=encodeURIComponent(i.retrieveLimit)),h=b.getExtraParams(i),"object"===a.type(h)&&a.extend(l,h),f=a.extend({},i.ajaxOptions,{url:g,data:l}),k=function(b){return a.isFunction(i.afterRequest)&&(b=i.afterRequest.apply(this,[b])),e(b,d)},j=a.ajax(f).done(k),c.onAjaxRequestDone(this,j,i),c.onAjaxRequestFail(this,j,i),c.onAjaxRequestAlways(this,j,i)};case"array":case"object":return function(a,b){return b(g,a)}}}())?this.each(function(){var b,f,g,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;switch(i.inputAttrs=a.extend(i.inputAttrs,{}),u=!1,s=a(this),m=null,n=null,o=null,p=null,q=null,i.asHtmlID?(m=i.asHtmlID,n=m,p="as-values-"+m,i.useOriginalInputName?(q=s.attr("name"),s.attr({name:"old_"+s.attr("name")})):q="as_values_"+m):(m=""+(m||"")+Math.floor(100*Math.random()),n="as-input-"+m,p="as-values-"+m,i.useOriginalInputName?(q=s.attr("name"),s.attr({name:"old_"+s.attr("name")})):q="as_values_"+m),i.inputAttrs.id=n,i.usePlaceholder||(i.inputAttrs.placeholder=i.startText),s.attr(i.inputAttrs),s.addClass("as-input"),i.usePlaceholder||s.val(i.startText),s.wrap('<ul class="as-selections" id="as-selections-'+m+'"></ul>').wrap('<li class="as-original" id="as-original-'+m+'"></li>'),J=a("#as-selections-"+m),t=a("#as-original-"+m),H=a('<div class="as-results" id="as-results-'+m+'"></div>'),I=a('<ul class="as-list"></ul>'),o=a('<input type="hidden" class="as-values" name="'+q+'" id="'+p+'" />'),l=new d(o),v=null,K=null,D="",z=!1,y=null,C=0,G={add:function(b){var c,d;c=a(J).find("li").length,d=f(b,"u"+c),null!=d&&d.addClass("blur")},remove:function(a){l.remove(a),J.find('li[data-value="'+e.escapeHtml(a)+'"]').remove()}},g=function(){return{add:G.add,remove:G.remove}},s.bind("addSelection",function(a,b){return G.add(b)}),s.bind("removeSelection",function(a,b){return G.remove(b)}),f=function(b,d){var f,g;return l.add(b[i.selectedValuesProp]),g=a('<li class="as-selection-item" id="as-selection-'+d+'" data-value="'+e.escapeQuotes(e.escapeHtml(b[i.selectedValuesProp]))+'"></li>'),g.on({click:function(){m=a(this),c.onSelectionClick(s,m,i,b[i.selectedValuesProp],l.getAll()),J.children().removeClass("selected"),m.addClass("selected")},mousedown:function(){u=!1}}),f=a('<a class="as-close">&times;</a>'),f.click(function(){return l.remove(b[i.selectedValuesProp]),c.onSelectionRemove(s,g,i,null,l.getAll()),u=!0,s.focus(),!1}),"string"!=typeof b[i.selectedItemProp]?c.onSelectionAdd(s,t,g.append(b[i.selectedItemProp]).prepend(f),i,b,l.getAll()):c.onSelectionAdd(s,t,g.text(b[i.selectedItemProp]).prepend(f),i,b,l.getAll()),t.prev()},a.isFunction(i.start)&&i.start.call(this,g()),a.type(i.preFill)){case"string":for(Q=i.preFill.split(","),M=0,O=Q.length;O>M;M++)L=Q[M],w={},w[""+i.selectedValuesProp]=L,""!==L&&f(w,"000"+r);break;case"array":if(i.preFill.length)for(a.isFunction(i.afterRequest)&&(i.preFill=i.afterRequest.call(this,i.preFill)),R=i.preFill,r=N=0,P=R.length;P>N;r=++N)w=R[r],B=w[i.selectedValuesProp],"undefined"==typeof B&&(B=""),""!==B&&f(w,"000"+r)}return l.isEmpty()||(s.val(""),J.find("li.as-selection-item").addClass("blur").removeClass("selected"),e.setPlaceholderEnabled(s,!1)),s.after(o),J.on({click:function(){u=!0,s.focus()},mousedown:function(){J.children().removeClass("selected"),u=!1}}),J.after(H),x=function(){var a,b,c;return 46===y||h.call(function(){for(c=[],b=9;31>b;b++)c.push(b);return c}.apply(this),y)>=0?(H.hide(),void 0):(a=s.val().replace(/[\\]+|[\/]+/g,""),""===a||a!==D?(D=a,a.length>=i.minChars||0===i.minChars&&0===a.length?(J.addClass("loading"),F(a)):(J.removeClass("loading"),H.hide())):void 0)},F=function(c){return a.isFunction(i.beforeRequest)&&(c=i.beforeRequest.apply(this,[c,i])),b(),k(c,E)},E=function(b,c){var d,g,h,j,k,n,o,p,q,r,t,v,x,y,A;for(i.matchCase||(c=c.toLowerCase()),c=c.replace("(","(","g").replace(")",")","g"),h=0,H.hide().html(I.html("")),k=0,t=0,x=b.length;x>t;t++){if(w=b[t],C++,g=!1,"value"===i.searchObjProps)p=w.value;else for(p="",A=i.searchObjProps.split(","),v=0,y=A.length;y>v;v++)j=A[v],p+=""+w[a.trim(j)]+" ";if(p&&(i.matchCase||(p=p.toLowerCase()),i.searchActive&&(-1===p.indexOf(c)&&!i.remoteFilter||l.exist(w[i.selectedValuesProp]))||(g=!0)),g&&(d=a('<li class="as-result-item" id="as-result-item-'+k+'"></li>'),d.on({click:function(){var c,d;m=a(this),d=m.data("data"),c=d.num,J.find("#as-selection-"+c).length<=0&&!z&&(b=d.attributes,s.val("").focus(),D="",f(b,c),a.isFunction(i.onResultItemClick)&&i.onResultItemClick.call(this,d),H.hide()),z=!1},mousedown:function(){u=!1},mouseover:function(){m=a(this),I.find("li").removeClass("active"),m.addClass("active")}}),d.data("data",{attributes:b[k],num:C}),r=a.extend({},b[k]),c=c.replace(/"/g,'\\"'),n=i.matchCase?new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.escapeHtml(c)+")(?![^<>]*>)(?![^&;]+;)","g"):new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.escapeHtml(c)+")(?![^<>]*>)(?![^&;]+;)","gi"),"string"==typeof r[i.selectedItemProp]?(r[i.selectedItemProp]=e.escapeHtml(r[i.selectedItemProp]),i.resultsHighlight&&c.length>0&&(r[i.selectedItemProp]=r[i.selectedItemProp].replace(n,"<em>$1</em>"))):i.resultsHighlight&&c.length>0&&r[i.selectedItemProp].html(r[i.selectedItemProp].html().replace(n,"<em>$1</em>")),d=i.formatList?i.formatList.call(this,r,d):d.html(r[i.selectedItemProp]),I.append(d),h++,i.retrieveLimit&&i.retrieveLimit===h))break;k+=1}J.removeClass("loading"),0>=h&&(q=i.emptyText,"regexp"===a.type(i.emptyTextPlaceholder)&&(q=q.replace(i.emptyTextPlaceholder,c)),I.html('<li class="as-message">'+q+"</li>")),I.css({width:J.outerWidth()}),o=h>0||i.showResultListWhenNoMatch,o&&H.show(),a.isFunction(i.afterResultListShow)&&i.afterResultListShow.call(this,o)},A=function(a){var b,c,d;if(H.find(":visible").length){switch(c=H.find("li"),a){case"down":d=c.eq(0);break;default:d=c.filter(":last")}if(b=H.find("li.active:first"),b.length)switch(a){case"down":d=b.next();break;default:d=b.prev()}c.removeClass("active"),d.addClass("active")}},b=function(){j&&(j.abort(),j=null)},s.on({focus:function(){return m=a(this),!i.usePlaceholder&&m.val()===i.startText&&l.isEmpty()?m.val(""):u&&(J.find("li.as-selections-item").removeClass("blur"),""!==m.val()&&(I.css({width:J.outerWidth()}),H.show())),v&&clearInterval(v),v=setInterval(function(){i.showResultList&&(i.selectionLimit&&J.find("li.as-selection-item").length>=i.selectionLimit?(I.html('<li class="as-message">'+i.limitText+"</li>"),H.show()):x())},i.keyDelay),u=!0,0===i.minChars&&F(m.val()),!0},blur:function(){m=a(this),!i.usePlaceholder&&""===m.val()&&l.isEmpty()&&i.minChars>0?m.val(i.startText):u&&(J.find("li.as-selection-item").addClass("blur").removeClass("selected"),H.hide()),v&&clearInterval(v),e.setPlaceholderEnabled(m,l.isEmpty())},keydown:function(d){var g,h,j,k,m,n;switch(y=d.keyCode,h=!1,d.keyCode){case 38:d.preventDefault(),A("up");break;case 40:d.preventDefault(),a(":visible",H).length>0?A("down"):(K&&clearTimeout(K),K=setTimeout(function(){x()},i.keyDelay));break;case 8:""===s.val()&&(n=l.getAll(),m=null,m=n.length?n[n.length-1]:null,J.children().not(t.prev()).removeClass("selected"),t.prev().hasClass("selected")?(l.remove(m),c.onSelectionRemove(s,t.prev(),i,null,l.getAll())):(c.onSelectionClick(s,t.prev(),i,null,l.getAll()),t.prev().addClass("selected"))),1===s.val().length&&(H.hide(),D="",b()),H.find(":visible").length&&(K&&clearTimeout(K),K=setTimeout(function(){x()},i.keyDelay));break;case 9:case 188:case 13:g=H.find("li.active:visible:first"),i.canGenerateNewSelections?(z=!0,j=s.val().replace(/(,)/g,""),""!==j&&!l.exist(j)&&j.length>=i.minChars&&0===g.length&&(i.neverSubmit||13!==d.keyCode)&&(d.preventDefault(),k={},k[""+i.selectedItemProp]=j,k[""+i.selectedValuesProp]=j,f(k,"00"+(J.find("li").length+1)),s.val(""),b())):s.val(""),g.length&&(z=!1,g.click(),H.hide()),(i.neverSubmit||g.length)&&d.preventDefault();break;case 27:i.preventPropagationOnEscape&&H.find(":visible").length&&d.stopPropagation();break;case 16:case 20:b(),H.hide()}e.setPlaceholderEnabled(s,l.isEmpty())}})}):void 0},add:function(){var b,c,d,e,f;for(d=1<=arguments.length?i.call(arguments,0):[],b=a(this),e=0,f=d.length;f>e;e++)c=d[e],b.trigger("addSelection",c)},remove:function(){var b,c,d,e,f;for(d=1<=arguments.length?i.call(arguments,0):[],b=a(this),e=0,f=d.length;f>e;e++)c=d[e],b.trigger("removeSelection",c)},defaults:function(b,c){null==c&&(c=!1),c&&(f={}),a.extend(f,b)}},a.fn.autoSuggest=function(a){return g[a]?g[a].apply(this,Array.prototype.slice.call(arguments,1)):g.init.apply(this,arguments)}}.call(this);